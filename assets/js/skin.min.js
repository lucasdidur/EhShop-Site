/*!
	Serverless 3D Minecraft Skin
	by James Mortemore of http://www.frostcast.net
	is licenced under a Creative Commons
	Attribution-NonCommercial-ShareAlike 2.0 UK: England & Wales.
	Based on minecraft skins in html5 canvas tags by Kent Rasmussen @ earthiverse.ath.cx
	Permissions beyond the scope of this licence 
	may be available at http://creativecommons.org/licenses/by-nc-sa/2.0/uk/.
	Additional licence terms at https://raw.github.com/confuser/Ban-Management/master/banmanagement/licence.txt
 */
(function(e){function r(e,t,n,r,i){var s=e.width;var o=e.height;t.clearRect(0,0,s,o);for(y=0;y<o;y++){for(x=0;x<s;x++){var u=(x+y*s)*4;t.fillStyle="rgba("+e.data[u+0]+","+e.data[u+1]+","+e.data[u+2]+","+e.data[u+3]+")";t.fillRect(n+x*i,r+y*i,i,i)}}}function i(e){var t=e.width;var n=e.height;var r=true;var i=""+e.data[0]+e.data[1]+e.data[2];for(y=0;y<n;y++){for(x=0;x<t;x++){var s=(x+y*t)*4;var o=""+e.data[s+0]+e.data[s+1]+e.data[s+2];if(o!==i){r=false;break}if(r==false)break}}return r}var t="minecraftSkin";var n={init:function(r){return this.each(function(i){var s=e(this);var o=s.data(t);if(!o){var u={scale:6,hat:true,draw:"model"};if(r){e.extend(true,u,r)}}u.username=s.data("minecraft-username");if(s.data("minecraft-scale"))u.scale=s.data("minecraft-scale");if(s.data("minecraft-draw"))u.draw=s.data("minecraft-draw");if(u.draw!="head"&&u.draw!="model")u.draw="model";n.requestData("https://s3.amazonaws.com/MinecraftSkins/"+u.username+".png",s,u)})},buildImage:function(e,t,r){if(!e)return;var i=document.createElement("canvas");var s=document.createElement("canvas");e=e.replace("application/octet-stream","image/png");if(r.draw=="model")n.draw_model(i,s,r.scale,r.hat,t,e);else if(r.draw=="head")n.draw_head(i,s,r.scale,r.hat,t,e)},requestData:function(t,r,i){var s;var o="https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('SELECT * FROM data.uri WHERE url = "'+t+'"')+"&format=json&callback=?";e.getJSON(o,function(e,t){if(e.query.results.url){n.buildImage(e.query.results.url,r,i)}else{n.requestData("https://s3.amazonaws.com/MinecraftSkins/char.png",r,i)}})},draw_head:function(e,t,n,s,o,u){var a=e.getContext("2d");var f=t.getContext("2d");t.setAttribute("width",64*n);t.setAttribute("height",32*n);t.setAttribute("class","scratch");e.setAttribute("width",20*n);e.setAttribute("height",17.6*n);e.setAttribute("class","model");o.append(e);o.append(t);var l=new Image;l.onload=function(){f.drawImage(l,0,0,64,32,0,0,64,32);r(f.getImageData(0,0,64,32),f,0,0,n);a.setTransform(1,-.5,0,1.2,0,0);a.drawImage(t,8*n,8*n,8*n,8*n,10*n,13/1.2*n,8*n,8*n);a.setTransform(1,.5,0,1.2,0,0);a.drawImage(t,0,8*n,8*n,8*n,2*n,3/1.2*n,8*n,8*n);a.setTransform(-1,.5,1,.5,0,0);a.scale(-1,1);a.drawImage(t,8*n,0,8*n,8*n,-3*n,5*n,8*n,8*n);if(s==true){if(!i(f.getImageData(40*n,8*n,8*n,8*n))){a.setTransform(1,-.5,0,1.2,0,0);a.drawImage(t,40*n,8*n,8*n,8*n,10*n,13/1.2*n,8*n,8*n);a.setTransform(1,.5,0,1.2,0,0);a.drawImage(t,32*n,8*n,8*n,8*n,2*n,3/1.2*n,8*n,8*n);a.setTransform(-1,.5,1,.5,0,0);a.scale(-1,1);a.drawImage(t,40*n,0,8*n,8*n,-3*n,5*n,8*n,8*n)}}};l.src=u},draw_model:function(e,t,n,s,o,u){var a=e.getContext("2d");var f=t.getContext("2d");t.setAttribute("width",64*n);t.setAttribute("height",32*n);t.setAttribute("class","scratch");e.setAttribute("width",20*n);e.setAttribute("height",44.8*n);e.setAttribute("class","model");o.append(e);o.append(t);var l=new Image;l.onload=function(){f.drawImage(l,0,0,64,32,0,0,64,32);r(f.getImageData(0,0,64,32),f,0,0,n);a.setTransform(1,-.5,0,1.2,0,0);a.scale(-1,1);a.drawImage(t,4*n,20*n,4*n,12*n,-16*n,34.4/1.2*n,4*n,12*n);a.setTransform(1,.5,0,1.2,0,0);a.drawImage(t,0*n,20*n,4*n,12*n,4*n,26.4/1.2*n,4*n,12*n);a.setTransform(1,-.5,0,1.2,0,0);a.drawImage(t,4*n,20*n,4*n,12*n,8*n,34.4/1.2*n,4*n,12*n);a.setTransform(1,-.5,0,1.2,0,0);a.scale(-1,1);a.drawImage(t,44*n,20*n,4*n,12*n,-20*n,20/1.2*n,4*n,12*n);a.setTransform(-1,.5,1,.5,0,0);a.drawImage(t,44*n,16*n,4*n,4*n,0,16*n,4*n,4*n);a.setTransform(1,-.5,0,1.2,0,0);a.drawImage(t,20*n,20*n,8*n,12*n,8*n,20/1.2*n,8*n,12*n);a.setTransform(1,.5,0,1.2,0,0);a.drawImage(t,40*n,20*n,4*n,12*n,0,16/1.2*n,4*n,12*n);a.setTransform(1,-.5,0,1.2,0,0);a.drawImage(t,44*n,20*n,4*n,12*n,4*n,20/1.2*n,4*n,12*n);a.setTransform(-1,.5,1,.5,0,0);a.scale(-1,1);a.drawImage(t,44*n,16*n,4*n,4*n,-16*n,16*n,4*n,4*n);a.setTransform(1,-.5,0,1.2,0,0);a.drawImage(t,8*n,8*n,8*n,8*n,10*n,13/1.2*n,8*n,8*n);a.setTransform(1,.5,0,1.2,0,0);a.drawImage(t,0,8*n,8*n,8*n,2*n,3/1.2*n,8*n,8*n);a.setTransform(-1,.5,1,.5,0,0);a.scale(-1,1);a.drawImage(t,8*n,0,8*n,8*n,-3*n,5*n,8*n,8*n);if(s==true){if(!i(f.getImageData(40*n,8*n,8*n,8*n))){a.setTransform(1,-.5,0,1.2,0,0);a.drawImage(t,40*n,8*n,8*n,8*n,10*n,13/1.2*n,8*n,8*n);a.setTransform(1,.5,0,1.2,0,0);a.drawImage(t,32*n,8*n,8*n,8*n,2*n,3/1.2*n,8*n,8*n);a.setTransform(-1,.5,1,.5,0,0);a.scale(-1,1);a.drawImage(t,40*n,0,8*n,8*n,-3*n,5*n,8*n,8*n)}}};l.src=u}};e.fn[t]=function(r){if(n[r]){return n[r].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof r==="object"||!r){return n.init.apply(this,arguments)}else{e.error("Method "+r+" does not exist in jQuery."+t)}}})(jQuery)